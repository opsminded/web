<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graph Database Visualization</title>
    <script src="/js/cytoscape.min.js"></script>
    <script src="/js/layout.js"></script>
    <script src="/js/cystyle.js"></script>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div id="controls">
        <h3>Controls</h3>
        <button onclick="openAddNodeModal()">Add Node</button>
        <button onclick="openAddEdgeModal()">Add Edge</button>

        <div class="divider"></div>

        <button onclick="cy.fit()">Fit to Screen</button>
        <button onclick="cy.center()">Center</button>
        <button onclick="cy.reset()">Reset View</button>
        <button onclick="loadData()">Reload Data</button>

        <label for="categoryFilter">Filter by Category:</label>
        <select id="categoryFilter" onchange="filterByCategory()">
            <option value="all">All Categories</option>
        </select>

        <div class="category-legend">
            <strong style="font-size: 13px;">Categories:</strong>
            <div id="categoryLegend"></div>
        </div>
    </div>

    <div id="cy"></div>

    <div id="info">
        <strong>Nodes:</strong> <span id="nodeCount">0</span> |
        <strong>Edges:</strong> <span id="edgeCount">0</span>
    </div>

    <!-- Add Node Modal -->
    <div id="addNodeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Node</h2>
                <span class="close" onclick="closeAddNodeModal()">&times;</span>
            </div>
            <form id="addNodeForm" onsubmit="return handleAddNode(event)">
                <div class="form-group">
                    <label for="nodeId">Node ID *</label>
                    <input type="text" id="nodeId" name="nodeId" required>
                    <small>Unique identifier for the node (e.g., web-server-01)</small>
                </div>
                <div class="form-group">
                    <label for="nodeCategory">Category *</label>
                    <select id="nodeCategory" name="nodeCategory" required>
                        <option value="">Select category</option>
                        <option value="business">Business</option>
                        <option value="application">Application</option>
                        <option value="infrastructure">Infrastructure</option>
                    </select>
                    <small>Determines the shape of the node</small>
                </div>
                <div class="form-group">
                    <label for="nodeType">Type *</label>
                    <select id="nodeType" name="nodeType" required>
                        <option value="">Select type</option>
                        <option value="server">Server</option>
                        <option value="database">Database</option>
                        <option value="application">Application</option>
                        <option value="network">Network</option>
                    </select>
                    <small>Determines the icon of the node</small>
                </div>
                <div class="form-group">
                    <label for="nodeLabel">Label</label>
                    <input type="text" id="nodeLabel" name="nodeLabel">
                    <small>Display label (defaults to ID if empty)</small>
                </div>
                <div class="form-group">
                    <label for="nodeUrl">URL</label>
                    <input type="url" id="nodeUrl" name="nodeUrl">
                    <small>Optional URL for this resource</small>
                </div>
                <div class="form-group">
                    <label for="nodeMetadata">Additional Metadata (JSON)</label>
                    <textarea id="nodeMetadata" name="nodeMetadata" placeholder='{"key": "value"}'></textarea>
                    <small>Optional: Additional properties as JSON</small>
                </div>
                <div>
                    <button type="submit" class="btn-primary">Create Node</button>
                    <button type="button" class="btn-secondary" onclick="closeAddNodeModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Edge Modal -->
    <div id="addEdgeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Edge</h2>
                <span class="close" onclick="closeAddEdgeModal()">&times;</span>
            </div>
            <form id="addEdgeForm" onsubmit="return handleAddEdge(event)">
                <div class="form-group">
                    <label for="edgeId">Edge ID *</label>
                    <input type="text" id="edgeId" name="edgeId" required>
                    <small>Unique identifier for the edge</small>
                </div>
                <div class="form-group">
                    <label for="edgeSource">Source Node *</label>
                    <input type="text" id="edgeSource" name="edgeSource" required list="nodeList">
                    <datalist id="nodeList"></datalist>
                    <small>Source node ID</small>
                </div>
                <div class="form-group">
                    <label for="edgeTarget">Target Node *</label>
                    <input type="text" id="edgeTarget" name="edgeTarget" required list="nodeList">
                    <small>Target node ID</small>
                </div>
                <div class="form-group">
                    <label for="edgeLabel">Label</label>
                    <input type="text" id="edgeLabel" name="edgeLabel">
                    <small>Relationship label (e.g., "depends on", "connects to")</small>
                </div>
                <div class="form-group">
                    <label for="edgeMetadata">Additional Metadata (JSON)</label>
                    <textarea id="edgeMetadata" name="edgeMetadata" placeholder='{"key": "value"}'></textarea>
                    <small>Optional: Additional properties as JSON</small>
                </div>
                <div>
                    <button type="submit" class="btn-primary">Create Edge</button>
                    <button type="button" class="btn-secondary" onclick="closeAddEdgeModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/js/main.js"></script>
</body>
</html>
